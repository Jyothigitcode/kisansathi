{% extends 'base.html' %}
{% block content %}
<div class="card fade-in">
  <div class="card-header flex items-center justify-between">
    <div>
      <h2 class="highlight-title">ğŸ” Password Strength Checker</h2>
      <p class="subtext">Test, visualize, and improve your password safely â€” nothing is stored on the server.</p>
    </div>
    <img src="/static/images/password-illus.png" alt="Password Illustration" class="inline-illus pulse">
  </div>

  <form id="pw-form" method="post" autocomplete="off" class="form-block">
    <label for="password-input" class="form-label">Enter a password to evaluate:</label>
    <div class="pw-row">
      <input id="password-input" name="password" type="password" class="form-input" required placeholder="Type a test password...">
      <div id="meter" class="strength-meter">
        <div class="strength-bar"></div>
      </div>
    </div>

    <div class="checks mt-2">
      <label class="checkbox">
        <input type="checkbox" name="confirm" required>
        <span>I confirm I own or control this data.</span>
      </label>

      <div class="btn-row mt-3">
        <button type="submit" class="btn-primary">ğŸ” Check Strength</button>
        <button type="button" id="generate-btn" class="btn-accent">âš™ï¸ Generate Strong</button>
      </div>
    </div>
  </form>

  <div id="pw-result" class="result-area slide-up">
    {% if result %}
      <h3>Result</h3>
      <p><strong>{{ result.strength }}</strong> (score {{ result.score }})</p>
      {% if result.suggestions %}
        <ul>{% for s in result.suggestions %}<li>{{ s }}</li>{% endfor %}</ul>
      {% endif %}
    {% endif %}
  </div>

  <hr>

  <h3 class="highlight">ğŸ§© Safe Demo: Hashed Password Match</h3>
  <p>Paste your own <strong>bcrypt</strong> hash (this demo tries a very small local wordlist).</p>
  <form id="crack-form" action="/password/demo_crack" method="post" class="form-block">
    <textarea name="hash" rows="3" class="form-input" placeholder="$2b$..."></textarea>

    <label class="checkbox mt-2">
      <input type="checkbox" name="confirm" required>
      <span>I confirm I own this hash/data.</span>
    </label>

    <div class="btn-row mt-3">
      <button type="submit" class="btn-primary">ğŸš€ Try Demo Crack</button>
      <button type="button" onclick="copyExampleHash()" class="btn-secondary">ğŸ“‹ Copy Example Hash</button>
    </div>
  </form>
</div>

<script>
  // Example hash (placeholder only)
  function copyExampleHash() {
    const example = '$2b$12$EXAMPLEEXAMPLEEXAMPLEEXAMPLEEXAMPLEEXAMPLEEXAMPLe';
    navigator.clipboard.writeText(example).then(() => {
      alert('Copied example bcrypt hash to clipboard.');
    });
  }

  // Interactive password strength meter (client-side preview)
  const input = document.getElementById('password-input');
  const meter = document.querySelector('.strength-bar');

  input.addEventListener('input', () => {
    const val = input.value;
    let score = 0;

    if (val.length >= 8) score++;
    if (/[A-Z]/.test(val)) score++;
    if (/[0-9]/.test(val)) score++;
    if (/[^A-Za-z0-9]/.test(val)) score++;
    if (val.length >= 12) score++;

    const percent = (score / 5) * 100;
    meter.style.width = percent + '%';

    meter.className = 'strength-bar';
    if (score <= 1) meter.classList.add('weak');
    else if (score <= 3) meter.classList.add('medium');
    else meter.classList.add('strong');
  });

  // Generate strong random password
  document.getElementById('generate-btn').addEventListener('click', () => {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()";
    let pwd = "";
    for (let i = 0; i < 14; i++) pwd += charset.charAt(Math.floor(Math.random() * charset.length));
    input.value = pwd;
    input.dispatchEvent(new Event('input'));
  });
</script>
{% endblock %}
